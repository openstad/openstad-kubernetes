
# Dependencies

dependencies:
  ## Database
  mongodb: 
    enabled: true
  mysql: 
    enabled: true

  ## SSL
  cert-manager: 
    enabled: false

# Define anchors

define:
  ## Environment
  namespace: &namespace openstad
  
  ## Services
  frontend:
    deploymentName: &fesDepName "frontend-deploy"
    ingressName: &fesIngName "openstad-ingress-frontend"
    serviceName: &fesName "frontend-service"
    servicePath: &fesPath /
    containerPort: &fesContainerPort 4444
    replicas: &fesReplicas 1

  auth:
    deploymentName: &asDepName "auth-deploy"
    ingressName: &asIngName "openstad-ingress-auth"
    serviceName: &asName "auth-service"
    servicePath: &asPath /oauth
    containerPort: &asContainerPort 4000
    replicas: &asReplicas 1
  
  api:
    deploymentName: &apiDepName "api-deploy"
    ingressName: &apiIngName "openstad-ingress-api"
    serviceName: &apiName "api-service"
    servicePath: &apiPath /api
    containerPort: &apiContainerPort 8111
    replicas: &apiReplicas 1
  
  image:
    deploymentName: &imgDepName "image-deploy"
    ingressName: &imgIngName "openstad-ingress-image"
    serviceName: &imgName "image-service"
    servicePath: &imgPath /img
    containerPort: &imgContainerPort 4100
    replicas: &imgReplicas 1
  
  adminer:
    deploymentName: &admDepName "adminer-deploy"
    ingressName: &admIngName "openstad-ingress-adminer"
    serviceName: &admName "adminer-service"
    servicePath: &admPath /adminer
    containerPort: &admContainerPort 80
    replicas: &admReplicas 1
  
  ## Host URLs
  host:
    host-url: &host-url www.openstad.softwaredepartment.net
    host-http: &host-http http://www.openstad.softwaredepartment.net
    host-https: &host-https https://www.openstad.softwaredepartment.net

  ## Databases
  mysql:
    username: &dbUser openstad
    password: &dbPass examplePass2146
    database: &dbName image

  mongodb:
    database: &mgdbDb openstad_mongodb

# Persistence

persistence:
  storageClassName: "hcloud-volumes"
  annotations: "{}"

# Frontend

frontend:
    replicas: *fesReplicas
    namespace: *namespace # Originally: openstad

    deploymentContainer:
        name: frontend-container # Originally: frontend
        image: openstad/frontend:debug # Originally: openstad/frontend:debug
        port: *fesContainerPort # Originally: 4444

    host:
        path: *fesPath

    deployment:
        name: *fesDepName # Originally: frontend

    service:
        name: *fesName # Originally: frontend-service
        httpPort: *fesContainerPort
        managementPort: 9090
    
    probe:
      liveness:
        initialDelaySeconds: 30
        periodSeconds: 60

# Adminer

adminer:
  replicas: *admReplicas

  namespace: *namespace
  service:
    name: *admName
  deployment:
    name: *admDepName
  
  label: adminer-web

  deploymentContainer:
    name: auth
    image: adminer
    port: *admContainerPort

  probe:
    liveness:
      initialDelaySeconds: 30
      periodSeconds: 60

# Auth

auth:
  replicas: *asReplicas

  namespace: *namespace
  service:
    name: *asName
  deployment:
    name: *asDepName
  
  label: auth-container

  host:
    path: *asPath

  deploymentContainer:
    name: auth-container
    image: openstad/auth:test
    port: *asContainerPort
  
  probe:
    liveness:
      initialDelaySeconds: 30
      periodSeconds: 60

# API

api:
  replicas: *apiReplicas
  
  namespace: *namespace
  service:
    name: *apiName
  deployment:
    name: *apiDepName
  
  label: openstad-api

  deploymentContainer:
    name: api-container
    image: openstad/api:test
    port: *apiContainerPort

  probe:
    liveness:
      initialDelaySeconds: 30
      periodSeconds: 60

# Image

image:
  replicas: *imgReplicas
  
  namespace: *namespace
  service:
    name: *imgName
  deployment:
    name: *imgDepName
  
  label: image-container

  deploymentContainer:
    name: image
    image: openstad/image:test
    port: *imgContainerPort

  probe:
    liveness:
      initialDelaySeconds: 30
      periodSeconds: 60



# Automatically configured sections

## Generic

host:
  www: *host-url
  http: *host-http
  https: *host-https

## Secrets

secrets:
  namespace: *namespace

  database: # SQL database
    secretName:
    image:
      secretName:
    auth:
      secretName:
      credentials:
        secretName:
    api:
      secretName:
    frontend:
      secretName:
    adminer:
      secretName:

    password: *dbPass
    username: *dbUser

  hosts:
    secretName:

  cookies:
    secretName:

  mail:
    auth:
      secretName:
    api:
      secretName:

  mongodb: # Mongo Database
    secretName:
    database: *mgdbDb

 
## TLS

tls:
  host: *host-url

## Ingress

ingress:
  namespace: *namespace

  adminerService:
    ingName: *admIngName
    name: *admName
    path: *admPath
    containerPort: *admContainerPort

  frontendService:
    ingName: *fesIngName
    name: *fesName
    path: *fesPath
    containerPort: *fesContainerPort

  authService:
    ingName: *asIngName
    name: *asName
    path: *asPath
    containerPort: *asContainerPort
  
  apiService:
    ingName: *apiIngName
    name: *apiName
    path: *apiPath
    containerPort: *apiContainerPort
  
  imageService:
    ingName: *imgIngName
    name: *imgName
    path: *imgPath
    containerPort: *imgContainerPort

## Subcharts

### MongoDB overwrite subchart

mongodb:
  mongodbUsername: *dbUser
  mongodbPassword: *dbPass
  mongodbDatabase: *mgdbDb

### MySQL overwrite subchart

mysql:
  db:
    user: *dbUser
    password: *dbPass
    name: *dbName